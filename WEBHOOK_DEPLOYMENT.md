# Webhook –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ GitHub webhook.

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Webhook

- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –Ω–µ –Ω—É–∂–Ω—ã SSH –∫–ª—é—á–∏
- ‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π** - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ push
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ GitHub
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–µ–ø–ª–æ–µ–≤
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å SSH

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /var/www/verifyboxlending
npm install --save express winston
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
mkdir -p logs
chmod 755 logs
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```bash
# Webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
WEBHOOK_SECRET=your-super-secret-key-here
WEBHOOK_PORT=3002
```

### 4. –ó–∞–ø—É—Å–∫ webhook —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /var/www/verifyboxlending
node webhook-server.js
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PM2 –¥–ª—è webhook

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
pm2 start webhook-server.js --name webhook-server
pm2 save
pm2 startup
```

### 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx:

```nginx
# –í /etc/nginx/sites-available/verifybox
location /webhook/ {
    proxy_pass http://localhost:3002;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Nginx:

```bash
sudo nginx -t
sudo systemctl reload nginx
```

## üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Webhook

### 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Webhooks**
3. –ù–∞–∂–º–∏—Ç–µ **Add webhook**

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **Payload URL** | `https://verifybox.tech/webhook/github` |
| **Content type** | `application/json` |
| **Secret** | `your-super-secret-key-here` (—Ç–æ—Ç –∂–µ —á—Ç–æ –≤ .env) |
| **Events** | –í—ã–±–µ—Ä–∏—Ç–µ "Just the push event" |
| **Active** | ‚úÖ –í–∫–ª—é—á–µ–Ω–æ |

### 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ webhook

–ù–∞–∂–º–∏—Ç–µ **Add webhook** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç–∞—Ç—É—Å –∑–µ–ª–µ–Ω—ã–π.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
curl https://verifybox.tech/webhook/health

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
{
  "status": "ok",
  "timestamp": "2024-01-15T10:30:00.000Z",
  "uptime": 3600
}
```

### 2. –¢–µ—Å—Ç–æ–≤—ã–π push

```bash
# –°–¥–µ–ª–∞–π—Ç–µ –Ω–µ–±–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –∫–æ–¥–µ
echo "// Test comment" >> proxy/server.cjs

# –ö–æ–º–º–∏—Ç –∏ push
git add .
git commit -m "test: webhook deployment"
git push origin main
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
pm2 logs webhook-server
pm2 logs proxy
```

## üìã –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—á–µ—Ä–µ–∑ webhook)

1. **Push –≤ main** ‚Üí GitHub –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook
2. **Webhook —Å–µ—Ä–≤–µ—Ä** –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏** ‚Üí –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
4. **Git pull** ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
5. **npm install** ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
6. **pm2 restart** ‚Üí –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
7. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí –∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –†—É—á–Ω–æ–π (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /var/www/verifyboxlending
git pull origin main
cd proxy
npm install --production
pm2 restart proxy
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ webhook —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
pm2 logs webhook-server

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Ñ–∞–π–ª–∞
tail -f logs/webhook.log
```

### –°—Ç–∞—Ç—É—Å PM2

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ proxy
pm2 logs proxy
```

### GitHub Webhook

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Webhooks**
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –≤–∞—à webhook
3. –°–º–æ—Ç—Ä–∏—Ç–µ **Recent Deliveries**

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Webhook –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å webhook —Å–µ—Ä–≤–µ—Ä–∞
pm2 status webhook-server

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs webhook-server --lines 20

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å webhook —Å–µ—Ä–≤–µ—Ä
pm2 restart webhook-server
```

### –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å WEBHOOK_SECRET –≤ .env
cat .env | grep WEBHOOK_SECRET

# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ GitHub –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```

### –û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la /var/www/verifyboxlending

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Git —Å—Ç–∞—Ç—É—Å
cd /var/www/verifyboxlending
git status

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PM2 —Å—Ç–∞—Ç—É—Å
pm2 status
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏

Webhook –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å GitHub –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–¥–¥–µ–ª–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

```bash
# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ webhook endpoint
# –í Nginx –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å IP whitelist
location /webhook/ {
    allow 192.168.1.0/24;
    deny all;
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
}
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞:

- –ü–æ–ª—É—á–µ–Ω–∏–µ webhook
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–ø–ª–æ—è
- –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–ø–ª–æ—è

## üìä –°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è

### –£—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π

```
‚úÖ Deployment completed successfully!
PM2 Status: online
Git: up to date
```

### –ù–µ—É–¥–∞—á–Ω—ã–π –¥–µ–ø–ª–æ–π

```
‚ùå Deployment failed!
Error: [–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏]
PM2 Status: errored
```

## üîÑ –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –ø—Ä–æ—à–µ–ª –Ω–µ—É–¥–∞—á–Ω–æ:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç–∫–∞—Ç–∏—Ç—å –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É
cd /var/www/verifyboxlending
git reset --hard HEAD~1
pm2 restart proxy
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏ webhook

- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ webhook
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –¥–µ–ø–ª–æ–µ–≤
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–ø–ª–æ—è

### –ê–ª–µ—Ä—Ç—ã

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –¥–µ–ø–ª–æ—è:

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ webhook-server.js
const sendAlert = (message) => {
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (email, Slack, etc.)
};
```

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—É—à–µ –≤ `main` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è —á–µ—Ä–µ–∑ webhook! üéâ
